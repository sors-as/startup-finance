<!DOCTYPE html>
<html>
<head>
    <title>Real-time JSON API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .endpoint { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .method { color: #fff; padding: 3px 8px; border-radius: 3px; font-size: 12px; font-weight: bold; }
        .get { background: #61affe; }
        .put { background: #49cc90; }
        pre { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Real-time JSON Object API</h1>
        <p>A Cloudflare Workers application with Durable Objects for managing JSON objects with real-time updates and anonymous authentication.</p>
        
        <h2>Authentication System</h2>
        <div class="endpoint">
            <h3>Composite ID Format</h3>
            <p><strong>Format:</strong> <code>{base58ID}-{base58EditKey}</code></p>
            <p><strong>ID Only:</strong> <code>abc12345</code> - Read access + WebSocket connections</p>
            <p><strong>ID + Edit Key:</strong> <code>abc12345-xyz98765</code> - Full read/write access</p>
            <p><strong>Base58:</strong> Uses Bitcoin alphabet (excludes 0, O, I, l for clarity)</p>
        </div>
        
        <h2>API Endpoints</h2>
        
        <div class="endpoint">
            <h3><span class="method get">GET</span> /api/objects/{id}</h3>
            <p>Fetch a JSON object by ID (no edit key required)</p>
            <p><strong>Examples:</strong> <code>/api/objects/abc12345</code></p>
            <p><strong>Response:</strong> JSON object with data, version, and lastModified timestamp</p>
        </div>
        
        <div class="endpoint">
            <h3><span class="method put">PUT</span> /api/objects/{id-editKey}</h3>
            <p>Create or update a JSON object (edit key required)</p>
            <p><strong>Examples:</strong> <code>/api/objects/abc12345-xyz98765</code></p>
            <p><strong>Body:</strong> Any valid JSON</p>
            <p><strong>Response:</strong> Updated object (includes id+editKey on creation)</p>
        </div>
        
        <div class="endpoint">
            <h3>WebSocket: /api/objects/{id}/ws</h3>
            <p>Real-time updates when objects are modified (read-only)</p>
            <p><strong>Examples:</strong> <code>/api/objects/abc12345/ws</code></p>
            <p><strong>Messages:</strong> JSON with type: "update" and object data</p>
        </div>

        <div class="endpoint">
            <h3><a href="/dashboard/demo">Interactive Demo Client</a></h3>
            <p>Test the API with a live interactive client</p>
        </div>
        
        <h2>Example Usage</h2>
        <pre>
// Create a new object (returns ID and edit key)
fetch('/api/objects/abc12345-xyz98765', {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name: 'John', age: 30 })
})
.then(r => r.json())
.then(result => {
    console.log('Created:', result);
    // Save the id and editKey for future updates
    const fullId = result.id + '-' + result.editKey;
});

// Update an existing object (edit key required)
fetch('/api/objects/abc12345-xyz98765', {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name: 'John Updated', age: 31 })
});

// Get an object (read-only, no edit key needed)
fetch('/api/objects/abc12345')
    .then(r => r.json())
    .then(console.log);

// WebSocket connection (read-only, no edit key needed)
const ws = new WebSocket('wss://your-worker.your-subdomain.workers.dev/api/objects/abc12345/ws');
ws.onmessage = (event) => {
    const update = JSON.parse(event.data);
    console.log('Object updated:', update);
};

// Attempting to update without edit key will fail with 403
fetch('/api/objects/abc12345', {
    method: 'PUT',
    body: JSON.stringify({ this: 'will fail' })
}); // Returns 403 Forbidden
        </pre>
    </div>
</body>
</html>